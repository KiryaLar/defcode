# Defcode - —Å–µ—Ä–≤–∏—Å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–¥–æ–≤ (OTP)

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–û–ø–∏—Å–∞–Ω–∏–µ](#–æ–ø–∏—Å–∞–Ω–∏–µ)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#—Å–±–æ—Ä–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-api)
  - [–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è](#–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
  - [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ OTP-–æ–ø–µ—Ä–∞—Ü–∏–∏](#–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ-otp-–æ–ø–µ—Ä–∞—Ü–∏–∏)
  - [–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ](#–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ)

## –û–ø–∏—Å–∞–Ω–∏–µ

**Defcode** - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–º–∏ –ø–∞—Ä–æ–ª—è–º–∏ (OTP), —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –Ω–∞ Spring Boot. –ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ OTP-–∫–æ–¥–æ–≤ —á–µ—Ä–µ–∑ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–∞–Ω–∞–ª—ã (SMS, Email, Telegram), –∞ —Ç–∞–∫–∂–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ OTP.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç
‚úîÔ∏è –°–æ–∑–¥–∞–≤–∞—Ç—å ¬´–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥ –∑–∞—â–∏—Ç–æ–π¬ª üîê
‚úîÔ∏è –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ —Ö—Ä–∞–Ω–∏—Ç—å OTP‚Äë–∫–æ–¥—ã ‚è±Ô∏è
‚úîÔ∏è –î–æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–¥—ã –ø–æ SMS, E‚Äëmail –∏ Telegram ‚úâÔ∏èü§ñ
‚úîÔ∏è –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∫–æ–¥ ‚úÖ
‚úîÔ∏è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–ª–∏–Ω—É –∏ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–æ–¥–∞ ‚öôÔ∏è

- –ö–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è¬ª) –∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞ (SMS, EMAIL, TELEGRAM) –∏ –∫–æ–Ω—Ç–∞–∫—Ç.
   
- –°–µ—Ä–≤–∏—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —á–∏—Å–ª–æ–≤–æ–π –∫–æ–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é‚ÄØ‚Äî 4‚ÄØ—Ü–∏—Ñ—Ä—ã, TTL‚ÄØ‚Äî 60‚ÄØ—Å–µ–∫).
- –ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ACTIVE –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫–∞–Ω–∞–ª–æ–º.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥ ‚Äî DefCode –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ —Å—Ç–∞—Ç—É—Å, —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.
- –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è TOTP: –∫–æ–¥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–≤—ã—à–∞–µ—Ç —Å—Ç–æ–π–∫–æ—Å—Ç—å.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
| –°—Ç–µ–∫                    | –í–µ—Ä—Å–∏—è / –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                           |
|-------------------------|-----------------------------------------------|
| Java                   | 17 LTS                                        |
| Spring Boot            | 3.2.x                                         |
| Spring Security + JWT  | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è / —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π             |
| Spring Data JPA, JDBC | –†–∞–±–æ—Ç–∞ —Å PostgreSQL                        |
| MapStruct              | –ú–∞–ø–ø–∏–Ω–≥ DTO ‚Üî Entity                         |
| Lombok                 | –£–º–µ–Ω—å—à–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ (boilerplate)      |
| Maven                  | –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞                                |
| PostgreSQL             | –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ OTP-–∫–æ–¥–æ–≤            |
| SLF4J + Logback        | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ                                   |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
src
‚îú‚îÄ‚îÄ‚îÄmain
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄjava
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄcom
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄlarkin
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ‚îÄdefcode
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ‚îÄconfig
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ‚îÄcontroller
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ‚îÄdao
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ‚îÄdto
‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ‚îÄrequest
‚îÇ   ‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄresponse
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ‚îÄentity
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ‚îÄexception
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ‚îÄmapper
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ‚îÄsecurity
‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ‚îÄconfig
‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ‚îÄfilter
‚îÇ   ‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄservice
‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ‚îÄservice
‚îÇ   ‚îÇ               ‚îî‚îÄ‚îÄ‚îÄutil
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄresources
‚îî‚îÄ‚îÄ‚îÄtest

```
–°—Ö–µ–º–∞ –ë–î –∏ —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ /src/main/resources/db.

## –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/username/defcode.git
cd defcode
```

### 2Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL 15+ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É defcode_db.

- –°–æ–∑–¥–∞–π—Ç–∏ application.yaml –Ω–∞ –æ—Å–Ω–æ–≤–µ application.yaml.origin –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞
### 3Ô∏è‚É£ –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
```bash
mvn clean install      # —Å–±–æ—Ä–∫–∞ –∏ —é–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç—ã
mvn spring-boot:run    # –∑–∞–ø—É—Å–∫
```
–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ API –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8080.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

    –í–æ –≤—Å–µ—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö HOST‚ÄØ=‚ÄØhttp://localhost:8080.
    –§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –≤—Ä–µ–º–µ–Ω–∏‚ÄØ‚Äî‚ÄØISO 8601.

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
| –ú–µ—Ç–æ–¥ | URL                  | –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞                  | –û–ø–∏—Å–∞–Ω–∏–µ                                |
|-------|-----------------------|-------------------------------|-----------------------------------------|
| POST  | `/auth/register`      | `{username, password, role}`  | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (—Ä–æ–ª—å: `ADMIN` –∏–ª–∏ `USER`)  |
| POST  | `/auth/login`         | `{username, password}`        | –ü–æ–ª—É—á–∏—Ç—å `accessToken` –∏ `refreshToken` |
| POST  | `/auth/refresh-token` | `{refreshToken}`              | –û–±–Ω–æ–≤–∏—Ç—å JWT‚Äë–ø–∞—Ä—É                        |
| POST  | `/auth/logout`        | `{refreshToken}`              | –û—Ç–æ–∑–≤–∞—Ç—å refresh‚Äë—Ç–æ–∫–µ–Ω                  |

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ POST `/auth/register`
```http
POST /auth/register
Content-Type: application/json

{
  "username": "user",
  "password": "Secret123",
  "role": "user",
}
```
**–û—Ç–≤–µ—Ç 201 Created**
```json
{
  "message": "User alice has successfully registered as an USER",
  "timestamp": "Tue May 01 12:45:01 GMT+03:00 2025"
}
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ POST `/auth/login`
```http
POST /auth/login
Content-Type: application/json

{
  "username": "user",
  "password": "Secret123"
}
```
**–û—Ç–≤–µ—Ç 200 OK**
```json
{
  "role": "USER",
  "accessToken": "<JWT>",
  "refreshToken": "<JWT>"
}
```
### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ POST `/auth/logout`
```http
POST /auth/logout
Content-Type: application/json

{
  "refreshToken": "<–≤–∞—à_refresh_token>"
}
```
**–û—Ç–≤–µ—Ç 200 OK**
```json
{
  "message": "Success logged out",
  "timestamp": "Tue May 01 12:45:01 GMT+03:00 2025"
}
```
### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ POST `/auth/refresh-token`
```http
POST /auth/refresh-token
Content-Type: application/json

{
  "refreshToken": "<–≤–∞—à_refresh_token>"
}
```
**–û—Ç–≤–µ—Ç 200 OK**
```json
{
  "role": "USER",
  "accessToken": "<–Ω–æ–≤—ã–π_access_token>",
  "refreshToken": "<–Ω–æ–≤—ã–π_refresh_token>"
}
```

–î–æ–±–∞–≤–ª—è–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization: Bearer <accessToken> –∫–æ –≤—Å–µ–º –∑–∞—â–∏—â—ë–Ω–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ OTP-–æ–ø–µ—Ä–∞—Ü–∏–∏

| –ú–µ—Ç–æ–¥ | URL                   | –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞                         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                     |
|-------|------------------------|--------------------------------------|--------------------------------|
| POST  | `/user/otp/generate`   | `{method, contact, operationType}`   | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ |
| POST  | `/user/otp/validate`   | `{code}`                             | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã–π –∫–æ–¥       |

### –ó–Ω–∞—á–µ–Ω–∏—è `operationType`:
1. Login Verification
2. Account Registration
3. Password Reset
4. Transaction Confirmation
5. Update Contact Information
6. Account Deletion

### –ü—Ä–∏–º–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞ –ø–æ SMS
```http
POST /user/otp/generate
Authorization: Bearer <accessToken>
Content-Type: application/json

{
  "method": "sms",
  "contact": "+79179997799",
  "operationType": "4"
}
```
### –ü—Ä–∏–º–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞ –ø–æ email
```http
POST /user/otp/generate
Authorization: Bearer <accessToken>
Content-Type: application/json

{
  "method": "email",
  "contact": "user@yande.ru",
  "operationType": "2"
}
```
### –ü—Ä–∏–º–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞ –ø–æ telegram
```http
POST /user/otp/generate
Authorization: Bearer <accessToken>
Content-Type: application/json

{
  "method": "telegram",
  "contact": "<telegram bot chat id>",
  "operationType": "4"
}
```
**–û—Ç–≤–µ—Ç 200 OK**
```json
{
  "message": "Code was successfully sent",
  "timestamp": "Tue May 01 12:45:01 GMT+03:00 2025"
}
```

### –ü—Ä–∏–º–µ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–¥–∞
```http
POST /user/otp/validate
Content-Type: application/json

{
  "code": "123456"
}
```
**–û—Ç–≤–µ—Ç 200 OK**
```json
{
  "message": "Code is correct",
  "timestamp": "Tue May 01 12:45:01 GMT+03:00 2025"
}
```

## –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
| –ú–µ—Ç–æ–¥ | URL                  | –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞               | –§—É–Ω–∫—Ü–∏—è                             |
|-------|-----------------------|----------------------------|-------------------------------------|
| PUT   | `/admin/otp-config`   | `{length, lifetime}`       | –ò–∑–º–µ–Ω–∏—Ç—å –¥–ª–∏–Ω—É –∏ TTL –∫–æ–¥–∞           |
| GET   | `/admin/users`        | ‚Äì                          | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (USER)|
| DELETE| `/admin/users/{id}`   | ‚Äì                          | –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                |
### –ó–Ω–∞—á–µ–Ω–∏—è `lifetime` –≤ –≤–∏–¥–µ —á–∏—Å–ª–æ + –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª –∏–∑ (smhd):
1. 30s
2. 2m
3. 3h
4. 1d

### –ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```http
PUT /admin/otp-config
Authorization: Bearer <accessToken>
Content-Type: application/json

{
  "length": 8,
  "lifetime": "2m"   // 2 –º–∏–Ω—É—Ç—ã 
}
```
**–û—Ç–≤–µ—Ç 200 OK**
```json
{
  "message": "OTP config was successfully changed: New duration: 2m New code length: 8",
  "timestamp": "Tue May 01 12:45:01 GMT+03:00 2025"
}
```

### –ü—Ä–∏–º–µ—Ä –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```http
GET /admin/users
Authorization: Bearer <access_token>
```
**–û—Ç–≤–µ—Ç 200 OK**
```json
[
  {
    "id": 1,
    "username": "user1"
  },
  {
    "id": 2,
    "username": "user2"
  }
]
```

### –ü—Ä–∏–º–µ—Ä —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```http
GET /admin/users/{id}
Authorization: Bearer <access_token>
```
**–û—Ç–≤–µ—Ç 200 OK**
```json
{
  "message": "User with id 1 deleted",
  "timestamp": "Tue May 01 12:55:01 GMT+03:00 2025"
}
```
